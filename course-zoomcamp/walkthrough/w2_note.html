<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.658">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="ปิยยุทธ จิตต์จำนงค์">

<title>MLZoomcamp Note Week 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="w2_note_files/libs/clipboard/clipboard.min.js"></script>
<script src="w2_note_files/libs/quarto-html/quarto.js"></script>
<script src="w2_note_files/libs/quarto-html/popper.min.js"></script>
<script src="w2_note_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="w2_note_files/libs/quarto-html/anchor.min.js"></script>
<link href="w2_note_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="w2_note_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="w2_note_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="w2_note_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="w2_note_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">2.1 Introduction</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">2.2 Data preparation</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">2.3 Exploratory data analysis (EDA)</a>
  <ul class="collapse">
  <li><a href="#numerical-variable" id="toc-numerical-variable" class="nav-link" data-scroll-target="#numerical-variable">Numerical Variable</a></li>
  <li><a href="#categorial-variables" id="toc-categorial-variables" class="nav-link" data-scroll-target="#categorial-variables">Categorial Variables</a></li>
  </ul></li>
  <li><a href="#validation-framework" id="toc-validation-framework" class="nav-link" data-scroll-target="#validation-framework">2.4 Validation framework</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">2.5 Linear regression</a></li>
  <li><a href="#linear-regression-vector-form" id="toc-linear-regression-vector-form" class="nav-link" data-scroll-target="#linear-regression-vector-form">2.6 Linear regression: vector form</a></li>
  <li><a href="#linear-regression-normal-equation" id="toc-linear-regression-normal-equation" class="nav-link" data-scroll-target="#linear-regression-normal-equation">2.7 Linear regression: normal equation</a></li>
  <li><a href="#baseline-model" id="toc-baseline-model" class="nav-link" data-scroll-target="#baseline-model">2.8 Baseline model</a></li>
  <li><a href="#root-mean-squared-error" id="toc-root-mean-squared-error" class="nav-link" data-scroll-target="#root-mean-squared-error">2.9 Root Mean Squared Error</a></li>
  <li><a href="#rmse-on-validation-set" id="toc-rmse-on-validation-set" class="nav-link" data-scroll-target="#rmse-on-validation-set">2.10 RMSE on validation set</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">2.11 Feature Engineering</a></li>
  <li><a href="#categorial-variables-1" id="toc-categorial-variables-1" class="nav-link" data-scroll-target="#categorial-variables-1">2.12 Categorial Variables</a></li>
  <li><a href="#regularization" id="toc-regularization" class="nav-link" data-scroll-target="#regularization">2.13 Regularization</a></li>
  <li><a href="#tuning-the-model" id="toc-tuning-the-model" class="nav-link" data-scroll-target="#tuning-the-model">2.14 Tuning the model</a></li>
  <li><a href="#using-the-model" id="toc-using-the-model" class="nav-link" data-scroll-target="#using-the-model">2.15 Using the model</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MLZoomcamp Note Week 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>ปิยยุทธ จิตต์จำนงค์ </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>2.1 Introduction</h1>
<p>เราจะสร้าง ML model สำหรับการทำนายราคารถยนต์มือสอง โดยใช้ข้อมูลจาก <a href="https://www.kaggle.com/CooperUnion/cardataset">Kaggle</a></p>
<p>Outline: - Data preparation - Exploratory data analysis - Linear regression - Evaluting the model with RMSE - Feature engineering - Regularization</p>
<p>Load packages</p>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ทำให้แสดงกราฟใน jupyter notebook ได้</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-preparation" class="level1">
<h1>2.2 Data preparation</h1>
<p>Download ข้อมูล สำหรับคนที่ยังไม่มีข้อมูล</p>
<blockquote class="blockquote">
<p><code>#</code> คือ comment ใช้อธิบาย แต่ไม่ได้ execute ถ้าอยากจะ excute code ให้ลบ <code>#</code> ออก</p>
</blockquote>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># URL = "https://raw.githubusercontent.com/alexeygrigorev/mlbookcamp-code/master/chapter-02-car-price/data.csv"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df = pd.read_csv(URL)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df.to_csv("data/car_price.csv", index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>นำเข้าข้อมูล เพื่อประมวณผล</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/car_price.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Make</th>
      <th>Model</th>
      <th>Year</th>
      <th>Engine Fuel Type</th>
      <th>Engine HP</th>
      <th>Engine Cylinders</th>
      <th>Transmission Type</th>
      <th>Driven_Wheels</th>
      <th>Number of Doors</th>
      <th>Market Category</th>
      <th>Vehicle Size</th>
      <th>Vehicle Style</th>
      <th>highway MPG</th>
      <th>city mpg</th>
      <th>Popularity</th>
      <th>MSRP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>BMW</td>
      <td>1 Series M</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>335.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Factory Tuner,Luxury,High-Performance</td>
      <td>Compact</td>
      <td>Coupe</td>
      <td>26</td>
      <td>19</td>
      <td>3916</td>
      <td>46135</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury,Performance</td>
      <td>Compact</td>
      <td>Convertible</td>
      <td>28</td>
      <td>19</td>
      <td>3916</td>
      <td>40650</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury,High-Performance</td>
      <td>Compact</td>
      <td>Coupe</td>
      <td>28</td>
      <td>20</td>
      <td>3916</td>
      <td>36350</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>230.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury,Performance</td>
      <td>Compact</td>
      <td>Coupe</td>
      <td>28</td>
      <td>18</td>
      <td>3916</td>
      <td>29450</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>230.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury</td>
      <td>Compact</td>
      <td>Convertible</td>
      <td>28</td>
      <td>18</td>
      <td>3916</td>
      <td>34500</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11909</th>
      <td>Acura</td>
      <td>ZDX</td>
      <td>2012</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>all wheel drive</td>
      <td>4.0</td>
      <td>Crossover,Hatchback,Luxury</td>
      <td>Midsize</td>
      <td>4dr Hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>46120</td>
    </tr>
    <tr>
      <th>11910</th>
      <td>Acura</td>
      <td>ZDX</td>
      <td>2012</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>all wheel drive</td>
      <td>4.0</td>
      <td>Crossover,Hatchback,Luxury</td>
      <td>Midsize</td>
      <td>4dr Hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>56670</td>
    </tr>
    <tr>
      <th>11911</th>
      <td>Acura</td>
      <td>ZDX</td>
      <td>2012</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>all wheel drive</td>
      <td>4.0</td>
      <td>Crossover,Hatchback,Luxury</td>
      <td>Midsize</td>
      <td>4dr Hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>50620</td>
    </tr>
    <tr>
      <th>11912</th>
      <td>Acura</td>
      <td>ZDX</td>
      <td>2013</td>
      <td>premium unleaded (recommended)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>all wheel drive</td>
      <td>4.0</td>
      <td>Crossover,Hatchback,Luxury</td>
      <td>Midsize</td>
      <td>4dr Hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>50920</td>
    </tr>
    <tr>
      <th>11913</th>
      <td>Lincoln</td>
      <td>Zephyr</td>
      <td>2006</td>
      <td>regular unleaded</td>
      <td>221.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>front wheel drive</td>
      <td>4.0</td>
      <td>Luxury</td>
      <td>Midsize</td>
      <td>Sedan</td>
      <td>26</td>
      <td>17</td>
      <td>61</td>
      <td>28995</td>
    </tr>
  </tbody>
</table>
<p>11914 rows × 16 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ดูขนาดของ data frame ด้วย attribute shape</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>(11914, 16)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ดูข้อมูล 5 แถวแรก ด้วย method head</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Make</th>
      <th>Model</th>
      <th>Year</th>
      <th>Engine Fuel Type</th>
      <th>Engine HP</th>
      <th>Engine Cylinders</th>
      <th>Transmission Type</th>
      <th>Driven_Wheels</th>
      <th>Number of Doors</th>
      <th>Market Category</th>
      <th>Vehicle Size</th>
      <th>Vehicle Style</th>
      <th>highway MPG</th>
      <th>city mpg</th>
      <th>Popularity</th>
      <th>MSRP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>BMW</td>
      <td>1 Series M</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>335.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Factory Tuner,Luxury,High-Performance</td>
      <td>Compact</td>
      <td>Coupe</td>
      <td>26</td>
      <td>19</td>
      <td>3916</td>
      <td>46135</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury,Performance</td>
      <td>Compact</td>
      <td>Convertible</td>
      <td>28</td>
      <td>19</td>
      <td>3916</td>
      <td>40650</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury,High-Performance</td>
      <td>Compact</td>
      <td>Coupe</td>
      <td>28</td>
      <td>20</td>
      <td>3916</td>
      <td>36350</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>230.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury,Performance</td>
      <td>Compact</td>
      <td>Coupe</td>
      <td>28</td>
      <td>18</td>
      <td>3916</td>
      <td>29450</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BMW</td>
      <td>1 Series</td>
      <td>2011</td>
      <td>premium unleaded (required)</td>
      <td>230.0</td>
      <td>6.0</td>
      <td>MANUAL</td>
      <td>rear wheel drive</td>
      <td>2.0</td>
      <td>Luxury</td>
      <td>Compact</td>
      <td>Convertible</td>
      <td>28</td>
      <td>18</td>
      <td>3916</td>
      <td>34500</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ดูข้อมูล 5 แถวแรก ด้วย method tail</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df.tail(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Make</th>
      <th>Model</th>
      <th>Year</th>
      <th>Engine Fuel Type</th>
      <th>Engine HP</th>
      <th>Engine Cylinders</th>
      <th>Transmission Type</th>
      <th>Driven_Wheels</th>
      <th>Number of Doors</th>
      <th>Market Category</th>
      <th>Vehicle Size</th>
      <th>Vehicle Style</th>
      <th>highway MPG</th>
      <th>city mpg</th>
      <th>Popularity</th>
      <th>MSRP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11911</th>
      <td>Acura</td>
      <td>ZDX</td>
      <td>2012</td>
      <td>premium unleaded (required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>all wheel drive</td>
      <td>4.0</td>
      <td>Crossover,Hatchback,Luxury</td>
      <td>Midsize</td>
      <td>4dr Hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>50620</td>
    </tr>
    <tr>
      <th>11912</th>
      <td>Acura</td>
      <td>ZDX</td>
      <td>2013</td>
      <td>premium unleaded (recommended)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>all wheel drive</td>
      <td>4.0</td>
      <td>Crossover,Hatchback,Luxury</td>
      <td>Midsize</td>
      <td>4dr Hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>50920</td>
    </tr>
    <tr>
      <th>11913</th>
      <td>Lincoln</td>
      <td>Zephyr</td>
      <td>2006</td>
      <td>regular unleaded</td>
      <td>221.0</td>
      <td>6.0</td>
      <td>AUTOMATIC</td>
      <td>front wheel drive</td>
      <td>4.0</td>
      <td>Luxury</td>
      <td>Midsize</td>
      <td>Sedan</td>
      <td>26</td>
      <td>17</td>
      <td>61</td>
      <td>28995</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ดูชื่อ column ด้วย attribute columns</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Index(['Make', 'Model', 'Year', 'Engine Fuel Type', 'Engine HP',
       'Engine Cylinders', 'Transmission Type', 'Driven_Wheels',
       'Number of Doors', 'Market Category', 'Vehicle Size', 'Vehicle Style',
       'highway MPG', 'city mpg', 'Popularity', 'MSRP'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># เปลี่ยนชื่อตัวแปร ให้เป็น snake_case (ตัวเล็ก และ คั่นด้วย _)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df.columns.<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Index(['make', 'model', 'year', 'engine_fuel_type', 'engine_hp',
       'engine_cylinders', 'transmission_type', 'driven_wheels',
       'number_of_doors', 'market_category', 'vehicle_size', 'vehicle_style',
       'highway_mpg', 'city_mpg', 'popularity', 'msrp'],
      dtype='object')</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save ทับ</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># เลือกเฉพาะ columns ที่เป็น string (object)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ตรวจสอบด้วย attribute dtypes</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>make                  object
model                 object
year                   int64
engine_fuel_type      object
engine_hp            float64
engine_cylinders     float64
transmission_type     object
driven_wheels         object
number_of_doors      float64
market_category       object
vehicle_size          object
vehicle_style         object
highway_mpg            int64
city_mpg               int64
popularity             int64
msrp                   int64
dtype: object</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># สร้างตัวแปรที่เก็บข้อมูล column ที่เป็น string (ข้อความ)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>string_columns <span class="op">=</span> <span class="bu">list</span>(df.columns[df.dtypes <span class="op">==</span> <span class="st">'object'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># แก้ไขข้อมูลในตัวแปรที่เป็นข้อความ ให้เป็น snake_case</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> string_columns:</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>make</th>
      <th>model</th>
      <th>year</th>
      <th>engine_fuel_type</th>
      <th>engine_hp</th>
      <th>engine_cylinders</th>
      <th>transmission_type</th>
      <th>driven_wheels</th>
      <th>number_of_doors</th>
      <th>market_category</th>
      <th>vehicle_size</th>
      <th>vehicle_style</th>
      <th>highway_mpg</th>
      <th>city_mpg</th>
      <th>popularity</th>
      <th>msrp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bmw</td>
      <td>1_series_m</td>
      <td>2011</td>
      <td>premium_unleaded_(required)</td>
      <td>335.0</td>
      <td>6.0</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>factory_tuner,luxury,high-performance</td>
      <td>compact</td>
      <td>coupe</td>
      <td>26</td>
      <td>19</td>
      <td>3916</td>
      <td>46135</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bmw</td>
      <td>1_series</td>
      <td>2011</td>
      <td>premium_unleaded_(required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>luxury,performance</td>
      <td>compact</td>
      <td>convertible</td>
      <td>28</td>
      <td>19</td>
      <td>3916</td>
      <td>40650</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bmw</td>
      <td>1_series</td>
      <td>2011</td>
      <td>premium_unleaded_(required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>luxury,high-performance</td>
      <td>compact</td>
      <td>coupe</td>
      <td>28</td>
      <td>20</td>
      <td>3916</td>
      <td>36350</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bmw</td>
      <td>1_series</td>
      <td>2011</td>
      <td>premium_unleaded_(required)</td>
      <td>230.0</td>
      <td>6.0</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>luxury,performance</td>
      <td>compact</td>
      <td>coupe</td>
      <td>28</td>
      <td>18</td>
      <td>3916</td>
      <td>29450</td>
    </tr>
    <tr>
      <th>4</th>
      <td>bmw</td>
      <td>1_series</td>
      <td>2011</td>
      <td>premium_unleaded_(required)</td>
      <td>230.0</td>
      <td>6.0</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>luxury</td>
      <td>compact</td>
      <td>convertible</td>
      <td>28</td>
      <td>18</td>
      <td>3916</td>
      <td>34500</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11909</th>
      <td>acura</td>
      <td>zdx</td>
      <td>2012</td>
      <td>premium_unleaded_(required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>crossover,hatchback,luxury</td>
      <td>midsize</td>
      <td>4dr_hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>46120</td>
    </tr>
    <tr>
      <th>11910</th>
      <td>acura</td>
      <td>zdx</td>
      <td>2012</td>
      <td>premium_unleaded_(required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>crossover,hatchback,luxury</td>
      <td>midsize</td>
      <td>4dr_hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>56670</td>
    </tr>
    <tr>
      <th>11911</th>
      <td>acura</td>
      <td>zdx</td>
      <td>2012</td>
      <td>premium_unleaded_(required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>crossover,hatchback,luxury</td>
      <td>midsize</td>
      <td>4dr_hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>50620</td>
    </tr>
    <tr>
      <th>11912</th>
      <td>acura</td>
      <td>zdx</td>
      <td>2013</td>
      <td>premium_unleaded_(recommended)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>crossover,hatchback,luxury</td>
      <td>midsize</td>
      <td>4dr_hatchback</td>
      <td>23</td>
      <td>16</td>
      <td>204</td>
      <td>50920</td>
    </tr>
    <tr>
      <th>11913</th>
      <td>lincoln</td>
      <td>zephyr</td>
      <td>2006</td>
      <td>regular_unleaded</td>
      <td>221.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>luxury</td>
      <td>midsize</td>
      <td>sedan</td>
      <td>26</td>
      <td>17</td>
      <td>61</td>
      <td>28995</td>
    </tr>
  </tbody>
</table>
<p>11914 rows × 16 columns</p>
</div>
</div>
</div>
</section>
<section id="exploratory-data-analysis-eda" class="level1">
<h1>2.3 Exploratory data analysis (EDA)</h1>
<p>เป็นขั้นตอนทำความเข้าใจข้อมูล เช่น การกระจายของข้อมูล การแจกแจงความถี่ ความสัมพันธ์ เป็นต้น</p>
<p>เครื่องมือช่วย</p>
<ul>
<li>Descriptive Statistics</li>
<li>Data Visualization</li>
</ul>
<p>อันดับแรกต้องรู้ว่าข้อมูลประเภทอะไร</p>
<ul>
<li>Numerical Variable</li>
<li>Categorial Variable</li>
</ul>
<p>เริ่มวิเคราะห์ 1 ตัวแปรก่อน แล้ววิเคราะห์ความสัมพันธ์ระหว่างตัวแปร</p>
<p>Numerical 1 ตัวแปร</p>
<ul>
<li>ค่าทางสถิติต่างๆ เช่น min, max, mean, median, IQR, skewness, kurtosis, etc.</li>
<li>การกระจาย เช่น histogram, boxplot, densitiy plot</li>
<li>missing</li>
</ul>
<p>Categorial 1 ตัวแปร</p>
<ul>
<li>จำนวน unique</li>
<li>ตารางแจกแจงความถี่</li>
<li>bar plot</li>
<li>missing</li>
</ul>
<section id="numerical-variable" class="level2">
<h2 class="anchored" data-anchor-id="numerical-variable">Numerical Variable</h2>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_num <span class="op">=</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_num.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>engine_hp</th>
      <th>engine_cylinders</th>
      <th>number_of_doors</th>
      <th>highway_mpg</th>
      <th>city_mpg</th>
      <th>popularity</th>
      <th>msrp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>11914.000000</td>
      <td>11845.00000</td>
      <td>11884.000000</td>
      <td>11908.000000</td>
      <td>11914.000000</td>
      <td>11914.000000</td>
      <td>11914.000000</td>
      <td>1.191400e+04</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2010.384338</td>
      <td>249.38607</td>
      <td>5.628829</td>
      <td>3.436093</td>
      <td>26.637485</td>
      <td>19.733255</td>
      <td>1554.911197</td>
      <td>4.059474e+04</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.579740</td>
      <td>109.19187</td>
      <td>1.780559</td>
      <td>0.881315</td>
      <td>8.863001</td>
      <td>8.987798</td>
      <td>1441.855347</td>
      <td>6.010910e+04</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1990.000000</td>
      <td>55.00000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>12.000000</td>
      <td>7.000000</td>
      <td>2.000000</td>
      <td>2.000000e+03</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2007.000000</td>
      <td>170.00000</td>
      <td>4.000000</td>
      <td>2.000000</td>
      <td>22.000000</td>
      <td>16.000000</td>
      <td>549.000000</td>
      <td>2.100000e+04</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2015.000000</td>
      <td>227.00000</td>
      <td>6.000000</td>
      <td>4.000000</td>
      <td>26.000000</td>
      <td>18.000000</td>
      <td>1385.000000</td>
      <td>2.999500e+04</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2016.000000</td>
      <td>300.00000</td>
      <td>6.000000</td>
      <td>4.000000</td>
      <td>30.000000</td>
      <td>22.000000</td>
      <td>2009.000000</td>
      <td>4.223125e+04</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2017.000000</td>
      <td>1001.00000</td>
      <td>16.000000</td>
      <td>4.000000</td>
      <td>354.000000</td>
      <td>137.000000</td>
      <td>5657.000000</td>
      <td>2.065902e+06</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ดู histogram การกระจายของข้อมูลราคา</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">4</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(df.msrp, bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Price'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of prices'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="w2_note_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ราคามีการแจกแจงที่ไม่ normal  </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(df.msrp[df.msrp <span class="op">&lt;</span> <span class="dv">100000</span>], bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Price'</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of prices'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="w2_note_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>log_price <span class="op">=</span> np.log1p(df.msrp)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>sns.histplot(log_price, bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Log(Price + 1)'</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of prices after log tranformation'</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="w2_note_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="categorial-variables" class="level2">
<h2 class="anchored" data-anchor-id="categorial-variables">Categorial Variables</h2>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_cat <span class="op">=</span> df.select_dtypes(include <span class="op">=</span> <span class="st">'object'</span>).copy()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df_cat.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>make</th>
      <th>model</th>
      <th>engine_fuel_type</th>
      <th>transmission_type</th>
      <th>driven_wheels</th>
      <th>market_category</th>
      <th>vehicle_size</th>
      <th>vehicle_style</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bmw</td>
      <td>1_series_m</td>
      <td>premium_unleaded_(required)</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>factory_tuner,luxury,high-performance</td>
      <td>compact</td>
      <td>coupe</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bmw</td>
      <td>1_series</td>
      <td>premium_unleaded_(required)</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>luxury,performance</td>
      <td>compact</td>
      <td>convertible</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_cat.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>make                    0
model                   0
engine_fuel_type        3
transmission_type       0
driven_wheels           0
market_category      3742
vehicle_size            0
vehicle_style           0
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>make                    0
model                   0
year                    0
engine_fuel_type        3
engine_hp              69
engine_cylinders       30
transmission_type       0
driven_wheels           0
number_of_doors         6
market_category      3742
vehicle_size            0
vehicle_style           0
highway_mpg             0
city_mpg                0
popularity              0
msrp                    0
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.make.nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>48</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df.make.value_counts().head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>chevrolet     1123
ford           881
volkswagen     809
toyota         746
dodge          626
Name: make, dtype: int64</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Bonus: EDA packages <a href="https://towardsdatascience.com/3-python-libraries-for-effective-eda-that-you-might-have-missed-3320f48ff070">link</a> - SweetViz: compare - DataPrep: interactive - Skimpy light weight</p>
</blockquote>
</section>
</section>
<section id="validation-framework" class="level1">
<h1>2.4 Validation framework</h1>
<p>เป็นการแบ่งข้อมูล ออกเป็นชุดๆ เพื่อใช้ในการทดสอบความแม่นยำของแบบจำลองและป้องกันปัญหา overfitting โดยในบทนี้จะการทำ hold-out validation และในสัปดาห์ 4 จะพูดถึงการทำ cross-validation</p>
<p>ในการทำ hold-out validation จะแบ่งออกเป็น 3 ชุด</p>
<ul>
<li>Test Set (ร้อยละ 20)</li>
<li>Validation Set (ร้อยละ 20)</li>
<li>Train Set (ร้อยละ 60)</li>
</ul>
<blockquote class="blockquote">
<p>สัดส่วนแล้วแต่ความเหมาะสม ไม่มีข้อกำหนดตายตัว</p>
</blockquote>
<p>ขั้นตอนในการทำคือ</p>
<ul>
<li>Train แบบจำลอง
<ul>
<li>กำหนด hyperparameter ต่างๆ ที่ต้องการทดสอบ</li>
<li>train แบบจำลอง ของ hyperparameter ต่างๆ โดยใช้ train set</li>
<li>ใช้แบบจำลองที่ได้ predict ข้อมูล validation set</li>
<li>ทดสอบความแม่นยำด้วย validation set</li>
<li>เปรียบเทียบแบบจำลองของแต่ละ hyperparameter ต่างๆ</li>
<li>ตัดสินใจเลือก hyperparameter ที่เหมาะสม</li>
</ul></li>
<li>Test แบบจำลอง
<ul>
<li>รวมข้อมูล train กับ validation set เรียกว่า full train set</li>
<li>train แบบจำลอง อีกครั้ง ด้วย hyperparameter ที่เลือกไว้ กับ full train</li>
<li>predict ข้อมูล test set</li>
<li>เปรียบเทียบประสิทธิภาพ (ความแม่นยำ) ของแบบจำลอง ระหว่าง validation และ test set</li>
<li>ถ้าแตกต่างกันไม่มาก แสดงว่าแบบจำลองใช้ได้ พร้อมนำไปใช้งานจริง</li>
<li>ใช้งานจริงอาจจะ retrain ใหม่กับ full dataset ก็ได้</li>
</ul></li>
</ul>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">2</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>n_val <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.2</span> <span class="op">*</span> n)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>n_test <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.2</span> <span class="op">*</span> n)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>n_train <span class="op">=</span> n <span class="op">-</span> (n_val <span class="op">+</span> n_test)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> np.arange(n)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>np.random.shuffle(idx)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>df_shuffled <span class="op">=</span> df.iloc[idx]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_shuffled.iloc[:n_train].copy()</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>df_val <span class="op">=</span> df_shuffled.iloc[n_train:n_train<span class="op">+</span>n_val].copy()</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df_shuffled.iloc[n_train<span class="op">+</span>n_val:].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>make</th>
      <th>model</th>
      <th>year</th>
      <th>engine_fuel_type</th>
      <th>engine_hp</th>
      <th>engine_cylinders</th>
      <th>transmission_type</th>
      <th>driven_wheels</th>
      <th>number_of_doors</th>
      <th>market_category</th>
      <th>vehicle_size</th>
      <th>vehicle_style</th>
      <th>highway_mpg</th>
      <th>city_mpg</th>
      <th>popularity</th>
      <th>msrp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2735</th>
      <td>chevrolet</td>
      <td>cobalt</td>
      <td>2008</td>
      <td>regular_unleaded</td>
      <td>148.0</td>
      <td>4.0</td>
      <td>manual</td>
      <td>front_wheel_drive</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>compact</td>
      <td>coupe</td>
      <td>33</td>
      <td>24</td>
      <td>1385</td>
      <td>14410</td>
    </tr>
    <tr>
      <th>6720</th>
      <td>toyota</td>
      <td>matrix</td>
      <td>2012</td>
      <td>regular_unleaded</td>
      <td>132.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>hatchback</td>
      <td>compact</td>
      <td>4dr_hatchback</td>
      <td>32</td>
      <td>25</td>
      <td>2031</td>
      <td>19685</td>
    </tr>
    <tr>
      <th>5878</th>
      <td>subaru</td>
      <td>impreza</td>
      <td>2016</td>
      <td>regular_unleaded</td>
      <td>148.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>hatchback</td>
      <td>compact</td>
      <td>4dr_hatchback</td>
      <td>37</td>
      <td>28</td>
      <td>640</td>
      <td>19795</td>
    </tr>
    <tr>
      <th>11190</th>
      <td>volkswagen</td>
      <td>vanagon</td>
      <td>1991</td>
      <td>regular_unleaded</td>
      <td>90.0</td>
      <td>4.0</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>large</td>
      <td>passenger_minivan</td>
      <td>18</td>
      <td>16</td>
      <td>873</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>4554</th>
      <td>ford</td>
      <td>f-150</td>
      <td>2017</td>
      <td>flex-fuel_(unleaded/e85)</td>
      <td>385.0</td>
      <td>8.0</td>
      <td>automatic</td>
      <td>four_wheel_drive</td>
      <td>4.0</td>
      <td>flex_fuel</td>
      <td>large</td>
      <td>crew_cab_pickup</td>
      <td>21</td>
      <td>15</td>
      <td>5657</td>
      <td>56260</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>434</th>
      <td>bmw</td>
      <td>4_series</td>
      <td>2015</td>
      <td>premium_unleaded_(required)</td>
      <td>300.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>luxury,performance</td>
      <td>midsize</td>
      <td>convertible</td>
      <td>31</td>
      <td>20</td>
      <td>3916</td>
      <td>54900</td>
    </tr>
    <tr>
      <th>1902</th>
      <td>volkswagen</td>
      <td>beetle</td>
      <td>2015</td>
      <td>premium_unleaded_(recommended)</td>
      <td>210.0</td>
      <td>4.0</td>
      <td>automated_manual</td>
      <td>front_wheel_drive</td>
      <td>2.0</td>
      <td>hatchback,performance</td>
      <td>compact</td>
      <td>2dr_hatchback</td>
      <td>30</td>
      <td>24</td>
      <td>873</td>
      <td>29215</td>
    </tr>
    <tr>
      <th>9334</th>
      <td>gmc</td>
      <td>sierra_1500</td>
      <td>2015</td>
      <td>flex-fuel_(unleaded/e85)</td>
      <td>285.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>four_wheel_drive</td>
      <td>4.0</td>
      <td>flex_fuel</td>
      <td>large</td>
      <td>extended_cab_pickup</td>
      <td>22</td>
      <td>17</td>
      <td>549</td>
      <td>34675</td>
    </tr>
    <tr>
      <th>5284</th>
      <td>rolls-royce</td>
      <td>ghost</td>
      <td>2014</td>
      <td>premium_unleaded_(required)</td>
      <td>563.0</td>
      <td>12.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>4.0</td>
      <td>exotic,luxury,performance</td>
      <td>large</td>
      <td>sedan</td>
      <td>21</td>
      <td>13</td>
      <td>86</td>
      <td>303300</td>
    </tr>
    <tr>
      <th>2420</th>
      <td>volkswagen</td>
      <td>cc</td>
      <td>2017</td>
      <td>premium_unleaded_(recommended)</td>
      <td>200.0</td>
      <td>4.0</td>
      <td>automated_manual</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>performance</td>
      <td>midsize</td>
      <td>sedan</td>
      <td>31</td>
      <td>22</td>
      <td>873</td>
      <td>37820</td>
    </tr>
  </tbody>
</table>
<p>7150 rows × 16 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>make</th>
      <th>model</th>
      <th>year</th>
      <th>engine_fuel_type</th>
      <th>engine_hp</th>
      <th>engine_cylinders</th>
      <th>transmission_type</th>
      <th>driven_wheels</th>
      <th>number_of_doors</th>
      <th>market_category</th>
      <th>vehicle_size</th>
      <th>vehicle_style</th>
      <th>highway_mpg</th>
      <th>city_mpg</th>
      <th>popularity</th>
      <th>msrp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2779</th>
      <td>chevrolet</td>
      <td>colorado</td>
      <td>2015</td>
      <td>regular_unleaded</td>
      <td>200.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>four_wheel_drive</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>compact</td>
      <td>extended_cab_pickup</td>
      <td>25</td>
      <td>19</td>
      <td>1385</td>
      <td>26885</td>
    </tr>
    <tr>
      <th>3708</th>
      <td>mercedes-benz</td>
      <td>e-class</td>
      <td>2017</td>
      <td>premium_unleaded_(required)</td>
      <td>241.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>luxury</td>
      <td>midsize</td>
      <td>sedan</td>
      <td>29</td>
      <td>22</td>
      <td>617</td>
      <td>54650</td>
    </tr>
    <tr>
      <th>4794</th>
      <td>ford</td>
      <td>focus</td>
      <td>2017</td>
      <td>flex-fuel_(unleaded/e85)</td>
      <td>160.0</td>
      <td>4.0</td>
      <td>manual</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>flex_fuel</td>
      <td>compact</td>
      <td>sedan</td>
      <td>36</td>
      <td>26</td>
      <td>5657</td>
      <td>16775</td>
    </tr>
    <tr>
      <th>10498</th>
      <td>acura</td>
      <td>tlx</td>
      <td>2016</td>
      <td>premium_unleaded_(recommended)</td>
      <td>290.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>luxury</td>
      <td>midsize</td>
      <td>sedan</td>
      <td>34</td>
      <td>21</td>
      <td>204</td>
      <td>42600</td>
    </tr>
    <tr>
      <th>1880</th>
      <td>volkswagen</td>
      <td>beetle_convertible</td>
      <td>2016</td>
      <td>regular_unleaded</td>
      <td>170.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>compact</td>
      <td>convertible</td>
      <td>34</td>
      <td>25</td>
      <td>873</td>
      <td>25995</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11123</th>
      <td>volvo</td>
      <td>v60</td>
      <td>2015</td>
      <td>regular_unleaded</td>
      <td>240.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>luxury</td>
      <td>midsize</td>
      <td>wagon</td>
      <td>37</td>
      <td>25</td>
      <td>870</td>
      <td>35750</td>
    </tr>
    <tr>
      <th>5549</th>
      <td>maserati</td>
      <td>granturismo_convertible</td>
      <td>2015</td>
      <td>premium_unleaded_(required)</td>
      <td>444.0</td>
      <td>8.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>exotic,luxury,high-performance</td>
      <td>midsize</td>
      <td>convertible</td>
      <td>20</td>
      <td>13</td>
      <td>238</td>
      <td>145740</td>
    </tr>
    <tr>
      <th>4146</th>
      <td>cadillac</td>
      <td>escalade_hybrid</td>
      <td>2013</td>
      <td>regular_unleaded</td>
      <td>332.0</td>
      <td>8.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>4.0</td>
      <td>luxury,hybrid</td>
      <td>large</td>
      <td>4dr_suv</td>
      <td>23</td>
      <td>20</td>
      <td>1624</td>
      <td>74425</td>
    </tr>
    <tr>
      <th>6337</th>
      <td>mitsubishi</td>
      <td>lancer</td>
      <td>2016</td>
      <td>regular_unleaded</td>
      <td>148.0</td>
      <td>4.0</td>
      <td>manual</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>compact</td>
      <td>sedan</td>
      <td>34</td>
      <td>24</td>
      <td>436</td>
      <td>17595</td>
    </tr>
    <tr>
      <th>9814</th>
      <td>kia</td>
      <td>sorento</td>
      <td>2015</td>
      <td>regular_unleaded</td>
      <td>290.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>crossover</td>
      <td>midsize</td>
      <td>4dr_suv</td>
      <td>25</td>
      <td>18</td>
      <td>1720</td>
      <td>26700</td>
    </tr>
  </tbody>
</table>
<p>2382 rows × 16 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>make</th>
      <th>model</th>
      <th>year</th>
      <th>engine_fuel_type</th>
      <th>engine_hp</th>
      <th>engine_cylinders</th>
      <th>transmission_type</th>
      <th>driven_wheels</th>
      <th>number_of_doors</th>
      <th>market_category</th>
      <th>vehicle_size</th>
      <th>vehicle_style</th>
      <th>highway_mpg</th>
      <th>city_mpg</th>
      <th>popularity</th>
      <th>msrp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11195</th>
      <td>gmc</td>
      <td>vandura</td>
      <td>1994</td>
      <td>regular_unleaded</td>
      <td>165.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>compact</td>
      <td>cargo_van</td>
      <td>20</td>
      <td>15</td>
      <td>549</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>673</th>
      <td>mercedes-benz</td>
      <td>600-class</td>
      <td>1993</td>
      <td>regular_unleaded</td>
      <td>389.0</td>
      <td>12.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>luxury</td>
      <td>large</td>
      <td>coupe</td>
      <td>15</td>
      <td>11</td>
      <td>617</td>
      <td>3211</td>
    </tr>
    <tr>
      <th>11270</th>
      <td>toyota</td>
      <td>venza</td>
      <td>2013</td>
      <td>regular_unleaded</td>
      <td>268.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>crossover,performance</td>
      <td>midsize</td>
      <td>wagon</td>
      <td>25</td>
      <td>18</td>
      <td>2031</td>
      <td>31120</td>
    </tr>
    <tr>
      <th>752</th>
      <td>volvo</td>
      <td>740</td>
      <td>1992</td>
      <td>regular_unleaded</td>
      <td>114.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>4.0</td>
      <td>luxury</td>
      <td>midsize</td>
      <td>sedan</td>
      <td>26</td>
      <td>18</td>
      <td>870</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>3137</th>
      <td>ford</td>
      <td>crown_victoria</td>
      <td>2010</td>
      <td>flex-fuel_(unleaded/e85)</td>
      <td>224.0</td>
      <td>8.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>4.0</td>
      <td>flex_fuel</td>
      <td>large</td>
      <td>sedan</td>
      <td>24</td>
      <td>16</td>
      <td>5657</td>
      <td>29905</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2514</th>
      <td>chevrolet</td>
      <td>chevy_van</td>
      <td>1998</td>
      <td>regular_unleaded</td>
      <td>200.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>midsize</td>
      <td>cargo_van</td>
      <td>18</td>
      <td>13</td>
      <td>1385</td>
      <td>2052</td>
    </tr>
    <tr>
      <th>11798</th>
      <td>subaru</td>
      <td>xv_crosstrek</td>
      <td>2014</td>
      <td>regular_unleaded</td>
      <td>160.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>crossover,hybrid</td>
      <td>compact</td>
      <td>4dr_suv</td>
      <td>33</td>
      <td>29</td>
      <td>640</td>
      <td>25995</td>
    </tr>
    <tr>
      <th>6637</th>
      <td>dodge</td>
      <td>magnum</td>
      <td>2006</td>
      <td>regular_unleaded</td>
      <td>250.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>large</td>
      <td>wagon</td>
      <td>22</td>
      <td>15</td>
      <td>1851</td>
      <td>29100</td>
    </tr>
    <tr>
      <th>2575</th>
      <td>honda</td>
      <td>civic</td>
      <td>2016</td>
      <td>regular_unleaded</td>
      <td>174.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>midsize</td>
      <td>sedan</td>
      <td>42</td>
      <td>31</td>
      <td>2202</td>
      <td>22200</td>
    </tr>
    <tr>
      <th>7336</th>
      <td>subaru</td>
      <td>outback</td>
      <td>2015</td>
      <td>regular_unleaded</td>
      <td>256.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>crossover</td>
      <td>midsize</td>
      <td>4dr_suv</td>
      <td>27</td>
      <td>20</td>
      <td>640</td>
      <td>32995</td>
    </tr>
  </tbody>
</table>
<p>2382 rows × 16 columns</p>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># แยก target ออกจาก features</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>y_train_orig <span class="op">=</span> df_train.msrp.values</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>y_val_orig <span class="op">=</span> df_val.msrp.values</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>y_test_orig <span class="op">=</span> df_test.msrp.values</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># transform ข้อมูล ด้วย np.log1p</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.log1p(df_train.msrp.values)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>y_val <span class="op">=</span> np.log1p(df_val.msrp.values)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> np.log1p(df_test.msrp.values)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ลบ target ออกจาก df เพื่อป้องกัน data leak</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">## ใช้ drop method ต้อง save ทับ</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_train.drop(columns<span class="op">=</span>[<span class="st">'msrp'</span>])</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>df_val <span class="op">=</span> df_val.drop(columns<span class="op">=</span>[<span class="st">'msrp'</span>])</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df_test.drop(columns<span class="op">=</span>[<span class="st">'msrp'</span>])</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">## ใช้ del keyword</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># del df_train['msrp']</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># del df_val['msrp']</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># del df_test['msrp']</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="linear-regression" class="level1">
<h1>2.5 Linear regression</h1>
<p>Linear regression เป็นการหาสมการเส้นตรง เพื่ออธิบายตัวแปร target (y) โดยใช้ตัวแปรอธิบาย X มีความสัมพันธ์เป็นเส้นตรง เช่น</p>
<p><span class="math display">\[
y_i = g(x_i)\\
y_i = w_0 + w_1 x_{1i} + w_2 x_{2i} + ... + w_n x_{ni}\\
y_i = w_0 + \sum_{j=1}^{n} w_{ij} x_{ij}
\]</span></p>
<p>โดยที่</p>
<ul>
<li><span class="math inline">\(y\)</span> คือ target เช่น ราคารถยนต์</li>
<li><span class="math inline">\(x_1 ... x_n\)</span> คือ features เช่น ผู้ผลิต ปี จำนวนแรงม้า เป็นต้น</li>
<li><span class="math inline">\(w_0\)</span> คือ bias หรือ intercept</li>
<li><span class="math inline">\(w_1 ... w_n\)</span> คือ weight หรือ slope</li>
<li><span class="math inline">\(n\)</span> คือ จำนวน feature</li>
<li><span class="math inline">\(i\)</span> คือ ข้อมูลแถวที่ <span class="math inline">\(i\)</span></li>
</ul>
<p>เป้าหมาย คือ การหาค่า <span class="math inline">\(w_0 ... w_n\)</span> ที่ทำให้เราสามารถทำนาย <span class="math inline">\(y\)</span> ได้ใกล้เคียงที่สุด ซึ่งมีหลายวิธี และ Linear regression เป็นวิธีหนึ่ง</p>
<blockquote class="blockquote">
<p>สำหรับคนที่เรียนสถิติ/เศรษฐมิติ วิธีนี้ก็คือ Ordinary Least Square</p>
</blockquote>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_train.iloc[<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>make                                 rolls-royce
model                     phantom_drophead_coupe
year                                        2015
engine_fuel_type     premium_unleaded_(required)
engine_hp                                  453.0
engine_cylinders                            12.0
transmission_type                      automatic
driven_wheels                   rear_wheel_drive
number_of_doors                              2.0
market_category        exotic,luxury,performance
vehicle_size                               large
vehicle_style                        convertible
highway_mpg                                   19
city_mpg                                      11
popularity                                    86
Name: 7557, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># toy example</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>xi <span class="op">=</span> [<span class="dv">453</span>, <span class="dv">11</span>, <span class="dv">86</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>w0 <span class="op">=</span> <span class="fl">7.17</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> [<span class="fl">0.01</span>, <span class="fl">0.04</span>, <span class="fl">0.002</span>]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> linear_regression(xi):</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(xi)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> w0</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> pred <span class="op">+</span> w[j] <span class="op">*</span> xi[j]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pred</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>linear_regression(xi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>12.312</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>np.expm1(linear_regression(xi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>222347.2221101062</code></pre>
</div>
</div>
</section>
<section id="linear-regression-vector-form" class="level1">
<h1>2.6 Linear regression: vector form</h1>
<p>ในบทที่แล้วเป็นการแสดงการคำนวณของ 1 แถว แต่เรามีข้อมูลมากกว่า 1 แถว ดังนั้นจึงขียนเป็น matrix</p>
<p><span class="math display">\[
\textbf{y} = g(\textbf{X})\\
\textbf{y} = \textbf{X}^T \textbf{w}
\]</span></p>
</section>
<section id="linear-regression-normal-equation" class="level1">
<h1>2.7 Linear regression: normal equation</h1>
<p>โจทย์ คือ ต้องการหา <span class="math inline">\(\textbf{w}\)</span> ซึ่งสามารถทำได้โดย</p>
<p><span class="math display">\[
\textbf{X} \textbf{w} = \textbf{y}\\
\textbf{X}^T \textbf{X} \textbf{w} = \textbf{X}^T \textbf{y}\\
(\textbf{X}^T \textbf{X}^T)^{-1} (\textbf{X}^T \textbf{X}) \textbf{w} = (\textbf{X}^T \textbf{X}^T)^{-1} \textbf{X}^T \textbf{y}\\
\textbf{w} = (\textbf{X}^T \textbf{X}^T)^{-1} \textbf{X}^T \textbf{y}\\
\]</span></p>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function ในการหาค่า parameter ด้วยวิธี linear regression</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_linear_regression(X, y):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    ones <span class="op">=</span> np.ones(X.shape[<span class="dv">0</span>])</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.column_stack([ones, X])</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    XTX <span class="op">=</span> X.T.dot(X)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    XTX_inv <span class="op">=</span> np.linalg.inv(XTX)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> XTX_inv.dot(X.T).dot(y)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w[<span class="dv">0</span>], w[<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="baseline-model" class="level1">
<h1>2.8 Baseline model</h1>
<p>แบบจำลองตั้งต้น baseline ใช้ตัวแปร</p>
<ul>
<li>engine_hp</li>
<li>engine_cylinders</li>
<li>highway_mpg</li>
<li>popularity</li>
</ul>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> [<span class="st">'engine_hp'</span>, <span class="st">'engine_cylinders'</span>, <span class="st">'highway_mpg'</span>, <span class="st">'city_mpg'</span>, <span class="st">'popularity'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># helper function สำหรับเตรียมข้อมูลเข้าแบบจำลอง</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_X(df):</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df[base]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df_num.fillna(<span class="dv">0</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_num.values</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train model</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># result</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>w_0, w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>(7.927257388069986,
 array([ 9.70589522e-03, -1.59103494e-01,  1.43792133e-02,  1.49441072e-02,
        -9.06908672e-06]))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>y_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>array([ 9.54792783,  9.38733977,  9.67197758, ..., 10.30423015,
       11.9778914 ,  9.99863111])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize เทียบค่าทำนายกับค่าจริง</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(y_train, label<span class="op">=</span><span class="st">'target'</span>, color<span class="op">=</span><span class="st">'#222222'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, bins<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>sns.histplot(y_pred, label<span class="op">=</span><span class="st">'prediction'</span>, color<span class="op">=</span><span class="st">'#aaaaaa'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, bins<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Log(Price + 1)'</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Predictions vs actual distribution'</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="w2_note_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="root-mean-squared-error" class="level1">
<h1>2.9 Root Mean Squared Error</h1>
<p>การวัดประสิทธิภาพ หรือ ความแม่นยำของแบบจำลอง มีหลายวิธี ขึ้นอยู่กับประเภทของตัวแปร target ด้วย ในกรณีของตัวแปร numerical/continuous มีหลายวิธี เช่น</p>
<ul>
<li>Root Mean Squared Error (RMSE)</li>
<li>Mean Absolute Error (MAE)</li>
<li>Mean Percentage Absolute Error (MAPE)</li>
</ul>
<p>ในบทนี้ใช้ RMSE โดย RMSE มีข้อดีคือ จะลงโทษค่าคลาดเคลื่อนที่ห่าง เพราะมีการยกกำลังสอง</p>
<p><span class="math display">\[
error_{i} = y_i - g(x_i)\\
\text{RMSE} = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (error_i)^2}\\
\text{MAE} = \frac{1}{n} \sum_{i=1}^{n} |error_i|\\
\text{MAPE} = \frac{1}{n} \sum_{i=1}^{n} \frac{|error_i|}{y_i}
\]</span></p>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># วัดค่าความคลาดเคลื่อนด้วย rmse</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmse(y, y_pred):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    error <span class="op">=</span> y_pred <span class="op">-</span> y</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> (error <span class="op">**</span> <span class="dv">2</span>).mean()</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="rmse-on-validation-set" class="level1">
<h1>2.10 RMSE on validation set</h1>
<p>ในการวัดความแม่นยำ เราต้องวัดกับข้อมูลคนละชุดกับข้อมูลที่ใช้ train ในขั้นนี้ ทดสอบความแม่นยำกับ validation set</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rmse กับข้อมูล training set</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>rmse(y_train, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0.7554192603920132</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ทดสอบกับ validation set</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>rmse(y_val, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0.761653099130156</code></pre>
</div>
</div>
</section>
<section id="feature-engineering" class="level1">
<h1>2.11 Feature Engineering</h1>
<p>Feature Engineering เป็นขั้นตอนในการสร้าง feature ใหม่ๆ จากข้อมูลตั้งต้น ซึ่ง feature ใหม่ สามารถใช้เพิ่มความแม่นยำของการพยากรณ์ได้</p>
<p>ในส่วนนี้จะเพิ่มตัวแปร ที่เป็นอายุของรถ โดยมีสมมติฐานว่า รถใหม่จะมีราคาขายรถมือสองที่สูงกว่า</p>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_X(df):</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> base.copy()</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'age'</span>] <span class="op">=</span> <span class="dv">2017</span> <span class="op">-</span> df.year</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    features.append(<span class="st">'age'</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df[features]</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df_num.fillna(<span class="dv">0</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_num.values</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train กับ features ใหม่</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression(X_train, y_train)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rmse train</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train'</span>, rmse(y_train, y_pred))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rmse validation</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation'</span>, rmse(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train 0.5175055465840046
validation 0.5172055461058299</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(y_val, label<span class="op">=</span><span class="st">'target'</span>, color<span class="op">=</span><span class="st">'#222222'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, bins<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(y_pred, label<span class="op">=</span><span class="st">'prediction'</span>, color<span class="op">=</span><span class="st">'#aaaaaa'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, bins<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Log(Price + 1)'</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Predictions vs actual distribution'</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="w2_note_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="categorial-variables-1" class="level1">
<h1>2.12 Categorial Variables</h1>
<p>ในบทนี้เป็นการใช้ประโยชน์ข้อมูล categorial เช่น ผู้ผลิต</p>
<p>วิธีการ ต้องแปลงข้อมูล categorial เป็นตัวเลข โดยใช้เทคนิค dummy variable หรือ one-hot coding กล่าวคือ สร้างตัวแปรของผู้ผลิตแต่ละผู้ผลิต โดย 1 = เป็นรถยนต์ที่ผู้ผลิตนั้น และ 0 = ไม่ใช่</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'number_of_doors'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>4.0    8353
2.0    3160
3.0     395
Name: number_of_doors, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'make'</span>].value_counts().head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>chevrolet     1123
ford           881
volkswagen     809
toyota         746
dodge          626
Name: make, dtype: int64</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_X(df):</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> base.copy()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'age'</span>] <span class="op">=</span> <span class="dv">2017</span> <span class="op">-</span> df.year</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    features.append(<span class="st">'age'</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'num_doors_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'number_of_doors'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'chevrolet'</span>, <span class="st">'ford'</span>, <span class="st">'volkswagen'</span>, <span class="st">'toyota'</span>, <span class="st">'dodge'</span>]:</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_make_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'make'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df[features]</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df_num.fillna(<span class="dv">0</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_num.values</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression(X_train, y_train)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train:'</span>, rmse(y_train, y_pred))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation:'</span>, rmse(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train: 0.5058876515487503
validation: 0.50760388495567</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'engine_fuel_type'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>regular_unleaded                                7172
premium_unleaded_(required)                     2009
premium_unleaded_(recommended)                  1523
flex-fuel_(unleaded/e85)                         899
diesel                                           154
electric                                          66
flex-fuel_(premium_unleaded_required/e85)         54
flex-fuel_(premium_unleaded_recommended/e85)      26
flex-fuel_(unleaded/natural_gas)                   6
natural_gas                                        2
Name: engine_fuel_type, dtype: int64</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_X(df):</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> base.copy()</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'age'</span>] <span class="op">=</span> <span class="dv">2017</span> <span class="op">-</span> df.year</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    features.append(<span class="st">'age'</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'num_doors_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'number_of_doors'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'chevrolet'</span>, <span class="st">'ford'</span>, <span class="st">'volkswagen'</span>, <span class="st">'toyota'</span>, <span class="st">'dodge'</span>]:</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_make_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'make'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'regular_unleaded'</span>, <span class="st">'premium_unleaded_(required)'</span>, </span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">'premium_unleaded_(recommended)'</span>, <span class="st">'flex-fuel_(unleaded/e85)'</span>]:</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_type_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'engine_fuel_type'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df[features]</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df_num.fillna(<span class="dv">0</span>)</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_num.values</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression(X_train, y_train)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train:'</span>, rmse(y_train, y_pred))</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation:'</span>, rmse(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train: 0.4788482615078598
validation: 0.47482567372234724</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'transmission_type'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>automatic           8266
manual              2935
automated_manual     626
direct_drive          68
unknown               19
Name: transmission_type, dtype: int64</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_X(df):</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> base.copy()</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'age'</span>] <span class="op">=</span> <span class="dv">2017</span> <span class="op">-</span> df.year</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    features.append(<span class="st">'age'</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'num_doors_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'number_of_doors'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'chevrolet'</span>, <span class="st">'ford'</span>, <span class="st">'volkswagen'</span>, <span class="st">'toyota'</span>, <span class="st">'dodge'</span>]:</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_make_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'make'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'regular_unleaded'</span>, <span class="st">'premium_unleaded_(required)'</span>, </span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">'premium_unleaded_(recommended)'</span>, <span class="st">'flex-fuel_(unleaded/e85)'</span>]:</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_type_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'engine_fuel_type'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'automatic'</span>, <span class="st">'manual'</span>, <span class="st">'automated_manual'</span>]:</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_transmission_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'transmission_type'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df[features]</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df_num.fillna(<span class="dv">0</span>)</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_num.values</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression(X_train, y_train)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train:'</span>, rmse(y_train, y_pred))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation:'</span>, rmse(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train: 0.4745380510924003
validation: 0.46858791946585304</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'driven_wheels'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>front_wheel_drive    4787
rear_wheel_drive     3371
all_wheel_drive      2353
four_wheel_drive     1403
Name: driven_wheels, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'market_category'</span>].value_counts().head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>crossover             1110
flex_fuel              872
luxury                 855
luxury,performance     673
hatchback              641
Name: market_category, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'vehicle_size'</span>].value_counts().head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>compact    4764
midsize    4373
large      2777
Name: vehicle_size, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'vehicle_style'</span>].value_counts().head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>sedan            3048
4dr_suv          2488
coupe            1211
convertible       793
4dr_hatchback     702
Name: vehicle_style, dtype: int64</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_X(df):</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.copy()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> base.copy()</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'age'</span>] <span class="op">=</span> <span class="dv">2017</span> <span class="op">-</span> df.year</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    features.append(<span class="st">'age'</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'num_doors_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'number_of_doors'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'chevrolet'</span>, <span class="st">'ford'</span>, <span class="st">'volkswagen'</span>, <span class="st">'toyota'</span>, <span class="st">'dodge'</span>]:</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_make_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'make'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'regular_unleaded'</span>, <span class="st">'premium_unleaded_(required)'</span>, </span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">'premium_unleaded_(recommended)'</span>, <span class="st">'flex-fuel_(unleaded/e85)'</span>]:</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_type_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'engine_fuel_type'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'automatic'</span>, <span class="st">'manual'</span>, <span class="st">'automated_manual'</span>]:</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_transmission_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'transmission_type'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'front_wheel_drive'</span>, <span class="st">'rear_wheel_drive'</span>, <span class="st">'all_wheel_drive'</span>, <span class="st">'four_wheel_drive'</span>]:</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_driven_wheens_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'driven_wheels'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'crossover'</span>, <span class="st">'flex_fuel'</span>, <span class="st">'luxury'</span>, <span class="st">'luxury,performance'</span>, <span class="st">'hatchback'</span>]:</span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_mc_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'market_category'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'compact'</span>, <span class="st">'midsize'</span>, <span class="st">'large'</span>]:</span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_size_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'vehicle_size'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> [<span class="st">'sedan'</span>, <span class="st">'4dr_suv'</span>, <span class="st">'coupe'</span>, <span class="st">'convertible'</span>, <span class="st">'4dr_hatchback'</span>]:</span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>        feature <span class="op">=</span> <span class="st">'is_style_</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> v</span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>        df[feature] <span class="op">=</span> (df[<span class="st">'vehicle_style'</span>] <span class="op">==</span> v).astype(<span class="bu">int</span>)</span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a>        features.append(feature)</span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df[features]</span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>    df_num <span class="op">=</span> df_num.fillna(<span class="dv">0</span>)</span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df_num.values</span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression(X_train, y_train)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train:'</span>, rmse(y_train, y_pred))</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation:'</span>, rmse(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train: 66.41939130116644
validation: 49.873533583264866</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(y_val, label<span class="op">=</span><span class="st">'target'</span>, color<span class="op">=</span><span class="st">'#222222'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, bins<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(y_pred, label<span class="op">=</span><span class="st">'prediction'</span>, color<span class="op">=</span><span class="st">'#aaaaaa'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, bins<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Log(Price + 1)'</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Predictions vs actual distribution'</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="w2_note_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<blockquote class="blockquote">
<p>การเพิ่มตัวแปรไปเรื่อยๆ ไม่ได้หมายความว่า แบบจำลองจะมีความแม่นยำมากขึ้น</p>
</blockquote>
</section>
<section id="regularization" class="level1">
<h1>2.13 Regularization</h1>
<p>ปัญหาหนึ่งที่อาจเกิดขึ้นได้ คือ</p>
<ul>
<li>ไม่สามารถหา inverse ของ (X^TX) ไม่ได้ Singular Matrix คือ มีบาง column ที่มีความสัมพันธ์กันเชิงเส้น</li>
<li>แต่ในการทำ numerical computation เลขที่ใช้เป็นทศนิยม ทำให้ยังสามารถ inverse ได้ทั้งที่ไม่ควร</li>
</ul>
<p>วิธีแก้ไข คือ การเพิ่มตัวเลขใน diaganal เพื่อให้โอกาสที่จะเกิดความสัมพันธ์เชิงเส้นเป็นไปได้ยากขึ้น วิธีที่นี้เรียกว่า <strong>Regularization</strong></p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ตัวอย่าง singular matrix</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>XTX <span class="op">=</span> [</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>],</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>XTX <span class="op">=</span> np.array(XTX)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>np.linalg.inv(XTX)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>LinAlgError: Singular matrix</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse ของ matrix ที่ค่ามีความคลาดเคลื่อนเล็กน้อย</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>XTX <span class="op">=</span> [</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">4.000001</span>],</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2</span>, <span class="fl">1.000001</span>, <span class="dv">2</span>]</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>XTX <span class="op">=</span> np.array(XTX)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>np.linalg.inv(XTX)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>array([[-3.33333222e-01,  8.33333222e-01, -1.66666611e-01],
       [-2.95874436e-11, -1.00000000e+06,  1.00000000e+06],
       [ 3.33333222e-01,  4.99999667e+05, -4.99999833e+05]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> np.eye(<span class="dv">3</span>) <span class="op">*</span> <span class="fl">0.01</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>XTX <span class="op">=</span> [</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>],</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>XTX <span class="op">=</span> np.array(XTX) <span class="op">+</span> alpha</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>np.linalg.inv(XTX)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>array([[ -0.33594125,   0.22321678,   0.44643355],
       [  0.22321678,  66.62909184, -66.74181631],
       [  0.22321678, -33.37090816,  33.25818369]])</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_linear_regression_reg(X, y, r<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  ones <span class="op">=</span> np.ones(X.shape[<span class="dv">0</span>])</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  X <span class="op">=</span> np.column_stack([ones, X])</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  XTX <span class="op">=</span> X.T.dot(X)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  XTX <span class="op">=</span> XTX <span class="op">+</span> r <span class="op">*</span> np.eye(XTX.shape[<span class="dv">0</span>])</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  XTX_inv <span class="op">=</span> np.linalg.inv(XTX)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  w <span class="op">=</span> XTX_inv.dot(X.T).dot(y)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> w[<span class="dv">0</span>], w[<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression_reg(X_train, y_train, r<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train:'</span>, rmse(y_train, y_pred))</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation:'</span>, rmse(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train: 0.4643444223655399
validation: 0.4603700695878582</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can change r</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression_reg(X_train, y_train, r<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_train.dot(w)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train:'</span>, rmse(y_train, y_pred))</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation:'</span>, rmse(y_val, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train: 0.4797496545423125
validation: 0.47572481006945594</code></pre>
</div>
</div>
</section>
<section id="tuning-the-model" class="level1">
<h1>2.14 Tuning the model</h1>
<p>จากการทำ regularization ผลลัพธ์ที่ได้ แตกต่างกันไปตามค่า ของ <code>r</code> ซึ่ง <code>r</code> ก็คือ hyperparameter ของ linear regression</p>
<p>แล้วเราจะเลือกค่า <code>r</code> อย่างไร &gt; ใช้วิธี Grid Search หาค่าที่เหมาะสม โดย train กับ train set และ วัดผลกับ validation set</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> prepare_X(df_train)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_val)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r <span class="kw">in</span> [<span class="fl">0.0</span>, <span class="fl">1e-5</span>, <span class="fl">1e-4</span>, <span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="dv">1</span>, <span class="dv">10</span>]:</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  w_0, w <span class="op">=</span> train_linear_regression_reg(X_train, y_train, r<span class="op">=</span>r)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  res[r] <span class="op">=</span> rmse(y_val, y_pred)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>{0.0: 49.873533583264866,
 1e-05: 0.46022537167467836,
 0.0001: 0.46022549097944854,
 0.001: 0.46022676259116185,
 0.01: 0.46023949631165534,
 0.1: 0.4603700695878582,
 1: 0.46182980426553016,
 10: 0.47572481006945594}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>r_best <span class="op">=</span> <span class="bu">min</span>(res, key<span class="op">=</span>res.get)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>r_best</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>1e-05</code></pre>
</div>
</div>
</section>
<section id="using-the-model" class="level1">
<h1>2.15 Using the model</h1>
<p>เมื่อได้ hyperparameter แล้ว เราพร้อมสำหรับทดสอบกับ test set</p>
<ul>
<li>รวมข้อมูล train กับ validation</li>
<li>retrain model อีกครั้งกับข้อมูลที่รวมกัน (full train)</li>
<li>ทดสอบความแม่นยำกับ test set คาดหวังว่าจะให้ค่าที่ไม่แตกต่างกัน</li>
</ul>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>df_fulltrain <span class="op">=</span> pd.concat([df_train, df_val]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>df_fulltrain</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>make</th>
      <th>model</th>
      <th>year</th>
      <th>engine_fuel_type</th>
      <th>engine_hp</th>
      <th>engine_cylinders</th>
      <th>transmission_type</th>
      <th>driven_wheels</th>
      <th>number_of_doors</th>
      <th>market_category</th>
      <th>vehicle_size</th>
      <th>vehicle_style</th>
      <th>highway_mpg</th>
      <th>city_mpg</th>
      <th>popularity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chevrolet</td>
      <td>cobalt</td>
      <td>2008</td>
      <td>regular_unleaded</td>
      <td>148.0</td>
      <td>4.0</td>
      <td>manual</td>
      <td>front_wheel_drive</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>compact</td>
      <td>coupe</td>
      <td>33</td>
      <td>24</td>
      <td>1385</td>
    </tr>
    <tr>
      <th>1</th>
      <td>toyota</td>
      <td>matrix</td>
      <td>2012</td>
      <td>regular_unleaded</td>
      <td>132.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>hatchback</td>
      <td>compact</td>
      <td>4dr_hatchback</td>
      <td>32</td>
      <td>25</td>
      <td>2031</td>
    </tr>
    <tr>
      <th>2</th>
      <td>subaru</td>
      <td>impreza</td>
      <td>2016</td>
      <td>regular_unleaded</td>
      <td>148.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>all_wheel_drive</td>
      <td>4.0</td>
      <td>hatchback</td>
      <td>compact</td>
      <td>4dr_hatchback</td>
      <td>37</td>
      <td>28</td>
      <td>640</td>
    </tr>
    <tr>
      <th>3</th>
      <td>volkswagen</td>
      <td>vanagon</td>
      <td>1991</td>
      <td>regular_unleaded</td>
      <td>90.0</td>
      <td>4.0</td>
      <td>manual</td>
      <td>rear_wheel_drive</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>large</td>
      <td>passenger_minivan</td>
      <td>18</td>
      <td>16</td>
      <td>873</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ford</td>
      <td>f-150</td>
      <td>2017</td>
      <td>flex-fuel_(unleaded/e85)</td>
      <td>385.0</td>
      <td>8.0</td>
      <td>automatic</td>
      <td>four_wheel_drive</td>
      <td>4.0</td>
      <td>flex_fuel</td>
      <td>large</td>
      <td>crew_cab_pickup</td>
      <td>21</td>
      <td>15</td>
      <td>5657</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9527</th>
      <td>volvo</td>
      <td>v60</td>
      <td>2015</td>
      <td>regular_unleaded</td>
      <td>240.0</td>
      <td>4.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>luxury</td>
      <td>midsize</td>
      <td>wagon</td>
      <td>37</td>
      <td>25</td>
      <td>870</td>
    </tr>
    <tr>
      <th>9528</th>
      <td>maserati</td>
      <td>granturismo_convertible</td>
      <td>2015</td>
      <td>premium_unleaded_(required)</td>
      <td>444.0</td>
      <td>8.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>2.0</td>
      <td>exotic,luxury,high-performance</td>
      <td>midsize</td>
      <td>convertible</td>
      <td>20</td>
      <td>13</td>
      <td>238</td>
    </tr>
    <tr>
      <th>9529</th>
      <td>cadillac</td>
      <td>escalade_hybrid</td>
      <td>2013</td>
      <td>regular_unleaded</td>
      <td>332.0</td>
      <td>8.0</td>
      <td>automatic</td>
      <td>rear_wheel_drive</td>
      <td>4.0</td>
      <td>luxury,hybrid</td>
      <td>large</td>
      <td>4dr_suv</td>
      <td>23</td>
      <td>20</td>
      <td>1624</td>
    </tr>
    <tr>
      <th>9530</th>
      <td>mitsubishi</td>
      <td>lancer</td>
      <td>2016</td>
      <td>regular_unleaded</td>
      <td>148.0</td>
      <td>4.0</td>
      <td>manual</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>compact</td>
      <td>sedan</td>
      <td>34</td>
      <td>24</td>
      <td>436</td>
    </tr>
    <tr>
      <th>9531</th>
      <td>kia</td>
      <td>sorento</td>
      <td>2015</td>
      <td>regular_unleaded</td>
      <td>290.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>crossover</td>
      <td>midsize</td>
      <td>4dr_suv</td>
      <td>25</td>
      <td>18</td>
      <td>1720</td>
    </tr>
  </tbody>
</table>
<p>9532 rows × 15 columns</p>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>X_fulltrain <span class="op">=</span> prepare_X(df_fulltrain)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>y_fulltrain <span class="op">=</span> np.concatenate([y_train, y_val])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can change r</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>X_fulltrain <span class="op">=</span> prepare_X(df_fulltrain)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>w_0, w <span class="op">=</span> train_linear_regression_reg(X_fulltrain, y_fulltrain, r<span class="op">=</span>r_best)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_fulltrain.dot(w)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'train:'</span>, rmse(y_fulltrain, y_pred))</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> prepare_X(df_test)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_val.dot(w)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'validation:'</span>, rmse(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>train: 0.46289480918119164
validation: 0.4561519402396736</code></pre>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>df_test.iloc[<span class="dv">20</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>make                            toyota
model                           sienna
year                              2015
engine_fuel_type      regular_unleaded
engine_hp                        266.0
engine_cylinders                   6.0
transmission_type            automatic
driven_wheels        front_wheel_drive
number_of_doors                    4.0
market_category                    NaN
vehicle_size                     large
vehicle_style        passenger_minivan
highway_mpg                         25
city_mpg                            18
popularity                        2031
Name: 9208, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>car <span class="op">=</span> df_test.iloc[<span class="dv">20</span>].to_dict()</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>car</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>{'make': 'toyota',
 'model': 'sienna',
 'year': 2015,
 'engine_fuel_type': 'regular_unleaded',
 'engine_hp': 266.0,
 'engine_cylinders': 6.0,
 'transmission_type': 'automatic',
 'driven_wheels': 'front_wheel_drive',
 'number_of_doors': 4.0,
 'market_category': nan,
 'vehicle_size': 'large',
 'vehicle_style': 'passenger_minivan',
 'highway_mpg': 25,
 'city_mpg': 18,
 'popularity': 2031}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>df_small <span class="op">=</span> pd.DataFrame([car])</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>df_small</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>make</th>
      <th>model</th>
      <th>year</th>
      <th>engine_fuel_type</th>
      <th>engine_hp</th>
      <th>engine_cylinders</th>
      <th>transmission_type</th>
      <th>driven_wheels</th>
      <th>number_of_doors</th>
      <th>market_category</th>
      <th>vehicle_size</th>
      <th>vehicle_style</th>
      <th>highway_mpg</th>
      <th>city_mpg</th>
      <th>popularity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>toyota</td>
      <td>sienna</td>
      <td>2015</td>
      <td>regular_unleaded</td>
      <td>266.0</td>
      <td>6.0</td>
      <td>automatic</td>
      <td>front_wheel_drive</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>large</td>
      <td>passenger_minivan</td>
      <td>25</td>
      <td>18</td>
      <td>2031</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>X_small <span class="op">=</span> prepare_X(df_small)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> w_0 <span class="op">+</span> X_small.dot(w)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>np.expm1(y_pred[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>33836.950010514745</code></pre>
</div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>np.expm1(y_test[<span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>35000.00000000001</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>